import api
import time
import sys

bundle_trytes ='GDDDPCAD9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999VCBPMVHSLISYGDCEAYH9PYNCITGQGXMRMMVQSJOR9YTSMIUCDILBWW9GATZDNBCNYXOGLLTNBIMQMO9LW999999999999999999999999999SXAM99999999999999999999999MAUSWYD99999999999999999999FANLKRRSRVOFSLJT9JDIIK9YGLHZZJTRSJFJJXDGLYVELFJIQVIXQQXU9FVVNHIRPLQJJBYQPEDHXYHEB999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SPAM99999999999999999999999999999999999999999999999999999999999999999999999999999'

port_1 = int(sys.argv[1])
port_2 = port_1 +1

url1 = "http://localhost:" + `port_1`
url2 = "http://localhost:" + `port_2`

folder = './'

result = api.attachToTangle(url1, api.all_nines, api.all_nines, 14, bundle_trytes);
if not result:
    print 'attach to tangle failed'
    exit(-1)

bundle_trytes = result.get('trytes')

result = api.storeTransactions(url1, bundle_trytes)

result = api.broadcastTransactions(url1, bundle_trytes)

time.sleep(1)

result = api.findTransactions(url2, "SXAM")
if not result:
    print 'find transactions failed'
    exit(-1)

found_trytes = result.get('hashes')

if (found_trytes != bundle_trytes):
    print 'Expecting: ' + bundle_trytes + '   Actual: ' + found_trytes
    exit(-1)

print "TEST SUCCESS"
